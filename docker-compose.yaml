version: '3.8'

services:
  app:
    image: collinsmutugi/medcard-frontend:v1.0
    container_name: medcard_frontend
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "8081:80"  # Map host port 8080 to container port 80
    environment:
      - VITE_BACKEND_URL=http://localhost:8000  # Set environment variables if needed

  backend:
    image: collinsmutugi/medcard-backend:v1.0
    container_name: medcard_backend
    restart: unless-stopped
    depends_on:
      - db
    ports:
      - "8000:8000"  # Map host port 8000 to container port 8000
    environment:
      - APP_NAME=Laravel
      - APP_ENV=local
      - APP_KEY=base64:/Y0UAZit9Qq8rqfecq1tdO5ZmxRzCwh0aIIZeWiSwQA=
      - APP_DEBUG=true
      - APP_URL=http://localhost
      - APP_LOCALE=en
      - APP_FALLBACK_LOCALE=en
      - APP_FAKER_LOCALE=en_US
      - APP_MAINTENANCE_DRIVER=file
      - PHP_CLI_SERVER_WORKERS=4
      - BCRYPT_ROUNDS=12
      - LOG_CHANNEL=stack
      - LOG_STACK=single
      - LOG_DEPRECATIONS_CHANNEL=null
      - LOG_LEVEL=debug
      - DB_CONNECTION=mysql
      - DB_HOST=db
      - DB_PORT=3306
      - DB_DATABASE=medcard
      - DB_USERNAME=root
      - DB_PASSWORD=mutush04
      - SESSION_DRIVER=database
      - SESSION_LIFETIME=120
      - SESSION_ENCRYPT=false
      - SESSION_PATH=/
      - SESSION_DOMAIN=localhost
      - SANCTUM_STATEFUL_DOMAINS=localhost:8081
      - BROADCAST_CONNECTION=log
      - FILESYSTEM_DISK=local
      - QUEUE_CONNECTION=database
      - CACHE_STORE=database
      - MEMCACHED_HOST=127.0.0.1
      - REDIS_CLIENT=phpredis
      - REDIS_HOST=127.0.0.1
      - REDIS_PASSWORD=null
      - REDIS_PORT=6379
      - VITE_APP_NAME="${APP_NAME}"
      - FRONTEND_URL=http://localhost:8081

    volumes:
      - backend_data:/app/storage

  db:
    image: collinsmutugi/medcard-db:v1.0
    container_name: medcard_db
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=mutush04
      - MYSQL_DATABASE=medcard
      - MYSQL_PASSWORD=mutush04
    ports:
      - "3306:3306"  # Map host port 3307 to container port 3306
    volumes:
      - db_data:/var/lib/mysql
  fastapi:
    image: collinsmutugi/medcard-facerec:v1.1
    container_name: fastapi-face
    restart: unless-stopped
    environment:
      - DATABASE_URL=mysql+mysqlconnector://root:mutush04@db/medcard
    ports:
      - "8001:8001"

volumes:
  backend_data:
    driver: local
  db_data:
    driver: local
